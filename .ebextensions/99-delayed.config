files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_delayed_job.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/usr/bin/env bash

      CALACADEMY_DIR="displays.calacademy.org"
      CALACADEMY_ENVIRONMENT=$(php -f /home/ec2-user/AWSUtil.php beanstalk-environment | xargs)

      if [ "$CALACADEMY_ENVIRONMENT" == "calacademy-displays-stg" ];
      then
        CALACADEMY_DIR="displays-stg.calacademy.org"
      fi

      if [ "$CALACADEMY_ENVIRONMENT" == "calacademy-displays-dev" ];
      then
        CALACADEMY_DIR="displays-dev.calacademy.org"
      fi

      ln -s /efs/$CALACADEMY_DIR/tmp /tmp-drupal
      ln -s /efs/$CALACADEMY_DIR/robots.txt /var/www/html/robots.txt
      ln -s /efs/$CALACADEMY_DIR/settings.php /var/www/html/sites/default/settings.php
      ln -s /efs/$CALACADEMY_DIR/files /var/www/html/sites/default/files
